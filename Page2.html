<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>CS 498:Final Project in D3.js</title>
    <link rel="stylesheet" type="text/css" href="starter-template.css">
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>
    <style type="text/css">
      /* mouse hover, lighten county color */
      path:hover {
      	fill-opacity: .6;
      }
      /* Style for Custom Tooltip */
      div.tooltip {
        position: absolute;
        text-align: center;
        width: 140px;
        height: 45px;
        padding: 2px;
        font: 12px sans-serif;
        background: white;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
      }
      </style>

</head>
<body>
<h1> Home Inspection Scores for Cook County</h1>
<section class="page2">
<p>
In this second visualization, we see how the home inspection score rank in just Cook county. Most of them are contained in the city of Chicago.

</p>
</section>

<script type="text/javascript">
    var w = 800;
    var h = 420;
    var projection = d3.geoAlbersUsa()
            .translate([w/4,6*h/10])
            .scale([1.25*w/2]);
    var path = d3.geoPath()
            .projection(projection);
    var projection2 = d3.geoAlbersUsa()
            .translate([3*w/4,6*h/10])
            .scale([1.25*w/2]);
    var path2 = d3.geoPath()
            .projection(projection2);
    var color = d3.scaleQuantize()
            .range(["rgb(237,248,233)","rgb(186,228,179)",
            "rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
    var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
    // Define the div for the tooltip
    var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
    //Load the cook county data
    d3.csv("cook.csv", function(data) {
        //Set input domain for color scale
        color.domain([
            d3.min(data, function(d) { return d.rank; }),
            d3.max(data, function(d) { return d.rank; })
        ]);
        //Load in GeoJSON data
        d3.json("mapshaper_illinois.json", function(json) {
            //Merge the ag. data and GeoJSON
            //Loop through once for each ag. data value
            for (var i = 0; i < data.length; i++) {
                //Grab county name
                var dataCounty = data[i].county;
                //Grab data value, and convert from string to float
                var dataValue = parseFloat(data[i].rank);
                //Find the corresponding county inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    var jsonCounty = json.features[j].properties.name;
                    if (dataCounty == jsonCounty) {
                        //Copy the data value into the JSON
                        json.features[j].properties.value = dataValue;
                        break;
                    }
                }
            }
            //Bind data and create one path per GeoJSON feature
            svg.selectAll("path.first")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("class", "first")
                    .attr("d", path)
                    .style("fill", function(d) {
                        //Get data value
                        var value = d.properties.value;
                        if (value) {
                            //If value exists…
                            scaled_val = (52-value)*255/52;
                            return d3.rgb(0, 0, scaled_val);
                        } else {
                            //If value is undefined…
                            return "#ccc";
                        }
                    })
                    .on("mouseover", function(d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div	.html( d.properties.name + "</br>" +
                                  "Rank: " + d.properties.value + "</br>"
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px"))
                        });
                    .on("mouseout", function(d) {
                        div.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });
        });
    });
    // add legend based on http://d3-legend.susielu.com/
    var linear = d3.scaleLinear()
    .domain([0,100]
    .range(["rgb(0, 0, 310)", "rgb(0, 0, 0)"]);
    var svg = d3.select("svg");
    svg.append("g")
      .attr("class", "legendLinear")
      .attr("transform", "translate(20,20)");
    var legendLinear = d3.legendColor()
      .shapeWidth(40)
      .shapeHeight(10) // default 15px
      .cells([1,10,20,30,40,52])
      .labelFormat(d3.format("d"))
      .title("Cook County Home Inspection Rank")
      .orient('horizontal')
      .scale(linear);
    svg.select(".legendLinear")
      .call(legendLinear);
    /*************************************
    /* Second graph
    /*************************************/
    //Load the county data
    d3.csv("inspection_scores_Illinois_only.csv", function(data) {
        //Set input domain for color scale
        color.domain([
            d3.min(data, function(d) { return d.rank; }),
            d3.max(data, function(d) { return d.rank; })
        ]);
        //Load in GeoJSON data
        d3.json("mapshaper_illinois.json", function(json) {
            //Merge the ag. data and GeoJSON
            //Loop through once for each ag. data value
            for (var i = 0; i < data.length; i++) {
                //Grab county name
                var dataCounty = data[i].county;
                //Grab data value, and convert from string to float
                var dataValue = parseFloat(data[i].rank);
                var dataScore = data[i].score;
                //console.log(data[i]);
                //Find the corresponding county inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    var jsonCounty = json.features[j].properties.name;
                    if (dataCounty == jsonCounty) {
                        //Copy the data value into the JSON
                        json.features[j].properties.value = dataValue;
                        json.features[j].properties.score = dataScore;
                        break;
                    }
                }
            }
            //Bind data and create one path per GeoJSON feature
            svg.selectAll("path.second")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("class", "second")
                    .attr("d", path2)
                    .style("fill", function(d) {
                        //Get data value
                        var value = d.properties.value;
                        if (value) {
                            //If value exists…
                            scaled_val = (52-value)*255/52;
                            return d3.rgb(0, scaled_val, 0);
                        } else {
                            //If value is undefined…
                            return "#ccc";
                        }
                    })
                    .on("mouseover", function(d) {
                          div.transition()
                              .duration(200)
                              .style("opacity", .9);
                          div	.html( d.properties.name + "</br>" +
                                    "Rank: " + d.properties.value + "</br>" +
                                    "Score: " + d.properties.score)
                              .style("left", (d3.event.pageX) + "px")
                              .style("top", (d3.event.pageY - 28) + "px");
                          })
                    .on("mouseout", function(d) {
                          div.transition()
                              .duration(500)
                              .style("opacity", 0);
                    });
        });
    });
    // add legend based on http://d3-legend.susielu.com/
    var linear2 = d3.scaleLinear()
    .domain([0,100])
    .range(["rgb(0, 300, 0)", "rgb(0, 0, 0)"]);
    var svg = d3.select("svg");
    svg.append("g")
      .attr("class", "legendLinear2")
      .attr("transform", "translate(420,20)"); // W = 800
    var legendLinear2 = d3.legendColor()
      .shapeWidth(40)
      .shapeHeight(10) // default 15px
      .cells([1,10,20,30,40,52])
      .labelFormat(d3.format("d"))
      .title("Home Inspection Rank")
      .orient('horizontal')
      .scale(linear2);
    svg.select(".legendLinear2")
      .call(legendLinear2);
</script>

<p class="page2">
</p>


<div class="center">
  <div class="pagination">
    <a href="Page1.html">&larr;</a>
    <a href="index.html">Home</a>
    <a href="Page1.html">1</a>
    <a href="Page2.html" class="active">2</a>
    <a href="References.html">References</a>
    <a href="third.html">&rarr;</a>
  </div>
</div>

<p class="page2">
<br>
Final Project
</p>
</body>
</html>
